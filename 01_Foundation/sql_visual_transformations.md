# ğŸ¨ SQL Data Flow: Visual Transformations

**Watch the table structure change at each step**

---

## ğŸ“Š Starting Data (FROM)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ customer_id â”‚ order_amount â”‚ order_date â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1      â”‚     100      â”‚ 2023-01-15 â”‚
â”‚      1      â”‚     200      â”‚ 2023-02-20 â”‚
â”‚      2      â”‚      50      â”‚ 2023-01-10 â”‚  â† Will be filtered
â”‚      2      â”‚     150      â”‚ 2023-03-05 â”‚
â”‚      3      â”‚     300      â”‚ 2023-01-25 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
            5 rows loaded
```

---

## â¬‡ï¸ Step 1: WHERE (Filter Rows)

**Query:** `WHERE order_amount > 75`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ customer_id â”‚ order_amount â”‚ order_date â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1      â”‚     100      â”‚ 2023-01-15 â”‚
â”‚      1      â”‚     200      â”‚ 2023-02-20 â”‚
â”‚      2      â”‚     150      â”‚ 2023-03-05 â”‚
â”‚      3      â”‚     300      â”‚ 2023-01-25 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        4 rows (removed $50 order)
```

---

## â¬‡ï¸ Step 2: GROUP BY (Collapse Rows)

**Query:** `GROUP BY customer_id`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ customer_id â”‚   orders_in_group    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1      â”‚   [100, 200]         â”‚ â† 2 orders combined
â”‚      2      â”‚   [150]              â”‚ â† 1 order
â”‚      3      â”‚   [300]              â”‚ â† 1 order
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
            3 groups created
```

---

## â¬‡ï¸ Step 3: HAVING (Filter Groups)

**Query:** `HAVING SUM(order_amount) > 200`

```
Calculations:
  Customer 1: 100 + 200 = 300 âœ… KEEP
  Customer 2: 150       = 150 âŒ REMOVE
  Customer 3: 300       = 300 âœ… KEEP

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ customer_id â”‚ total_amount â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1      â”‚     300      â”‚
â”‚      3      â”‚     300      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        2 groups remaining
```

---

## â¬‡ï¸ Step 4: SELECT (Pick Columns)

**Query:** `SELECT customer_id, SUM(order_amount) AS total`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ customer_id â”‚ total â”‚  â† Only these columns shown
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1      â”‚  300  â”‚
â”‚      3      â”‚  300  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        2 columns selected
```

---

## â¬‡ï¸ Step 5: ORDER BY (Sort)

**Query:** `ORDER BY total DESC`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ customer_id â”‚ total â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1      â”‚  300  â”‚  â† Sorted (tied, so order unchanged)
â”‚      3      â”‚  300  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
            Final Result
```

---

## ğŸ”— CTE Pipeline Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Raw Table (orders)       â”‚
â”‚  customer_id | amount | date     â”‚
â”‚       1      |  100   | 01-15    â”‚
â”‚       1      |  200   | 02-20    â”‚
â”‚       2      |   50   | 01-10    â”‚
â”‚       2      |  150   | 03-05    â”‚
â”‚       3      |  300   | 01-25    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        WHERE amount > 75
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CTE: step1               â”‚
â”‚  customer_id | total             â”‚
â”‚       1      |  300              â”‚
â”‚       2      |  150              â”‚
â”‚       3      |  300              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        WHERE total > 200
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CTE: step2               â”‚
â”‚  customer_id | total | rewards  â”‚
â”‚       1      |  300  |   30     â”‚
â”‚       3      |  300  |   30     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        ORDER BY rewards DESC
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Final Result             â”‚
â”‚  customer_id | total | rewards  â”‚
â”‚       1      |  300  |   30     â”‚
â”‚       3      |  300  |   30     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ WHERE vs HAVING (Visual)

### **WHERE (Filters Rows)**
```
Before:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID â”‚ Amount â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚  100   â”‚ âœ…
â”‚ 2  â”‚   50   â”‚ âŒ Filtered out
â”‚ 3  â”‚  200   â”‚ âœ…
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After WHERE amount > 75:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID â”‚ Amount â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚  100   â”‚
â”‚ 3  â”‚  200   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **HAVING (Filters Groups)**
```
Before (After GROUP BY):
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID â”‚ Total â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚  300  â”‚ âœ…
â”‚ 2  â”‚  150  â”‚ âŒ Filtered out
â”‚ 3  â”‚  300  â”‚ âœ…
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜

After HAVING Total > 200:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID â”‚ Total â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚  300  â”‚
â”‚ 3  â”‚  300  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Column Highlighting (Like Your Image)

### **CTE_1: Selecting Columns**
```
â”Œâ•â•â•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â•â”
â•‘  emp_id   â•‘ emp_nm  â•‘ salary â•‘ mnger_id  â•‘  â† Yellow = Selected
â•‘ (YELLOW)  â•‘         â•‘        â•‘ (YELLOW)  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•
```

### **CTE_2: Using Those Columns**
```
â”Œâ•â•â•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â”
â•‘  emp_id   â•‘ emp_nm  â•‘ salary â•‘  mng_id  â•‘
â•‘ (YELLOW)  â•‘         â•‘        â•‘ (YELLOW) â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•
```

**Yellow columns** = Used in JOIN or WHERE conditions
