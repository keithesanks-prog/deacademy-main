<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 2: The Nightly Batch</title>
    <!-- Learning Tracker -->
    <script src="../learning_tracker.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700&family=Fira+Code:wght@400;600&display=swap');

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1000px;
            margin: 40px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border-bottom: 8px solid #4f46e5;
        }

        .header {
            background: #4f46e5;
            color: white;
            padding: 50px;
            text-align: center;
        }

        .header h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: 3em;
            margin: 0;
            color: #c7d2fe;
        }

        .phase-block {
            padding: 40px;
            border-bottom: 2px solid #e2e8f0;
        }

        .phase-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2em;
            margin-bottom: 15px;
            color: #312e81;
        }

        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .role-manager {
            background: #fee2e2;
            color: #991b1b;
        }

        .role-engineer {
            background: #e0e7ff;
            color: #3730a3;
        }

        .whiteboard-box {
            background: #fffbeb;
            border: 4px solid #fcd34d;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            color: #451a03;
            margin: 20px 0;
            position: relative;
        }

        .problem-alert {
            background: #fef2f2;
            border-left: 5px solid #ef4444;
            padding: 15px;
            margin: 15px 0;
            color: #b91c1c;
        }

        .code-box {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Fira Code', monospace;
            overflow-x: auto;
            margin: 20px 0;
            border-left: 5px solid #818cf8;
        }

        .arrow-down {
            text-align: center;
            font-size: 2em;
            color: #94a3b8;
            margin: 20px 0;
        }

        .architecture-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            background: #f1f5f9;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .arch-node {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #cbd5e1;
            text-align: center;
            font-weight: bold;
            width: 120px;
        }
    </style>
</head>

<body data-module-name="04_projects_project_batch_etl">

    <!-- Nav -->
    <a href="../TRAINING_HUB.html"
        style="display: inline-block; margin: 20px; text-decoration: none; color: #333; font-weight: bold;">‚¨ÖÔ∏è Back to
        Hub</a>

    <div class="container">
        <div class="header">
            <h1>Project 2: The Nightly Batch</h1>
            <p>Building the "Data Lakehouse" Pipeline</p>
        </div>

        <!-- PHASE 1: THE PROBLEM -->
        <div class="phase-block">
            <span class="role-badge role-manager">Phase 1: The Complaint</span>
            <h2 class="phase-title">Background & Brief</h2>
            <p>Sarah (Manager) runs into the room looking stressed.</p>

            <div class="whiteboard-box">
                <h3>Sarah's Whiteboard:</h3>
                <p>"Every time the Finance Team runs their 'End of Day' report at 5 PM, the Customer App crashes!"</p>
                <p><strong>The Goal:</strong> I want the report. But I don't want to kill the App.</p>
            </div>

            <div class="problem-alert">
                <strong>The Engineer's Diagnosis:</strong>
                <br>
                They are running heavy SQL queries (Analytics) directly on the Production Database (MySQL).
                <br>
                <strong>Solution:</strong> We need to move the data stats to a separate place (Warehouse) before they
                query it.
            </div>
        </div>

        <div class="arrow-down">‚¨áÔ∏è</div>

        <!-- PHASE 2: THE STRATEGY -->
        <div class="phase-block">
            <span class="role-badge role-engineer">Phase 2: The Strategy</span>
            <h2 class="phase-title">Extract & Load (EL)</h2>
            <p>We can't query the Live DB. So, we will take a <strong>Snapshot</strong> at midnight (when traffic is
                low) and move it.</p>

            <div class="architecture-diagram">
                <div class="arch-node" style="border-color:#ef4444;">Live DB<br>(MySQL)</div>
                <div style="font-size: 2em;">‚û°Ô∏è</div>
                <div class="arch-node" style="border-color:#eab308;">S3 Bucket<br>(The Lake)</div>
                <div style="font-size: 2em;">‚û°Ô∏è</div>
                <div class="arch-node" style="border-color:#3b82f6;">Snowflake<br>(Warehouse)</div>
            </div>

            <p><strong>Why S3 in the middle?</strong> Because S3 is cheap reliable storage. If Snowflake dies, we still
                have the raw file in S3. This is the "Data Lake" safety net.</p>
        </div>

        <div class="arrow-down">‚¨áÔ∏è</div>

        <!-- PHASE 3: THE CODE (PYTHON) -->
        <div class="phase-block">
            <span class="role-badge role-engineer">Phase 3: The Script (Extraction)</span>
            <h2 class="phase-title">The "Dump Truck" Script</h2>
            <p>We write a Python script that runs every night at 12:00 AM.</p>

            <div class="code-box">
                <pre># nightly_job.py
import pandas as pd
import boto3

# 1. READ from Live DB (Only the changes since yesterday)
print("Reading from MySQL...")
df = pd.read_sql("SELECT * FROM orders WHERE date = 'yesterday'", db_connection)

# 2. SAVE to a CSV file (The Snapshot)
filename = "orders_2024_01_01.csv"
df.to_csv(filename)

# 3. UPLOAD to S3 (The Lake)
print("Uploading to S3...")
s3 = boto3.client('s3')
s3.upload_file(filename, 'my-company-data-lake', filename)

print("Done! Production DB is safe now.")
</pre>
            </div>
        </div>

        <div class="arrow-down">‚¨áÔ∏è</div>

        <!-- PHASE 4: THE WAREHOUSE LOAD -->
        <div class="phase-block">
            <span class="role-badge role-engineer">Phase 4: Snowflake Ingestion</span>
            <h2 class="phase-title">Loading the Warehouse</h2>
            <p>Now the file is in S3. Snowflake can see S3. We just tell it to "eat" the file.</p>

            <div class="code-box">
                <pre>-- Run this inside Snowflake
COPY INTO orders_table
FROM @my_s3_stage/orders_2024_01_01.csv
FILE_FORMAT = (type = csv);
</pre>
            </div>

            <p><strong>The Magic:</strong> This command takes seconds. Now the data is inside Snowflake's powerful
                storage.</p>
        </div>

        <div class="arrow-down">‚¨áÔ∏è</div>

        <!-- PHASE 5: THE TRANSFORMATION -->
        <div class="phase-block">
            <span class="role-badge role-engineer">Phase 5: The Transformation</span>
            <h2 class="phase-title">Gold Layer Logic</h2>
            <p>The Finance Team doesn't want raw rows. They want "Total Revenue".</p>
            <p>We run a SQL job inside Snowflake to build the final report.</p>

            <div class="code-box">
                <pre>-- Create the 'Gold' Report Table
CREATE TABLE daily_revenue_report AS
SELECT 
    date,
    SUM(total_amount) as revenue
FROM orders_table
GROUP BY date;
</pre>
            </div>

            <div class="whiteboard-box" style="border-color: #22c55e; background: #f0fdf4;">
                <h3>Final Result</h3>
                <p><strong>Sarah's Problem:</strong> Fixed. The App never crashes.</p>
                <p><strong>Finance Team:</strong> Happy. They query the 'daily_revenue_report' in Snowflake, which is
                    super fast.</p>
                <p><strong>You (The Engineer):</strong> You built a proper ETL Pipeline.</p>
            </div>
        </div>

        <div class="arrow-down">‚¨áÔ∏è</div>

        <!-- PHASE 6: THE ARCHITECT'S VIEW -->
        <div class="phase-block" style="border-bottom: none;">
            <span class="role-badge" style="background: #e11d48; color: white;">Phase 6: The Architect's View</span>
            <h2 class="phase-title">System Design Principles Used</h2>
            <p>Why did we build it this way? Here is the theory behind the code.</p>

            <div
                style="background: #fff1f2; padding: 25px; border-radius: 10px; border-left: 5px solid #e11d48; margin-bottom: 20px;">
                <h3>1. Separation of Concerns (The Wall) üß±</h3>
                <p><strong>Principle:</strong> OLTP (Selling stuff) should NEVER mix with OLAP (Analyzing stuff).</p>
                <p>We physically separated the systems. If the Analytics Server (Snowflake) explodes, the Store (MySQL)
                    keeps selling. One failure does not kill the other.</p>
            </div>

            <div
                style="background: #fff7ed; padding: 25px; border-radius: 10px; border-left: 5px solid #f97316; margin-bottom: 20px;">
                <h3>2. Idempotency (The "Re-Run" Rule) üîÅ</h3>
                <p><strong>Principle:</strong> If the script crashes halfway, can I run it again safely?</p>
                <p>Yes. Because we use "Snapshot Files" (orders_2024_01_01.csv). If we upload it twice, it just
                    overwrites the file. It doesn't create duplicate money. This is critical for sleep-filled nights.
                </p>
            </div>

            <div style="background: #ecfdf5; padding: 25px; border-radius: 10px; border-left: 5px solid #059669;">
                <h3>3. Elasticity (The Cloud Power) ‚òÅÔ∏è</h3>
                <p><strong>Principle:</strong> Managing unpredictable volume.</p>
                <p>S3 and Snowflake are "Elastic". If Black Friday happens and the file is 100x bigger, S3 just eats it.
                    We don't need to buy a bigger hard drive. The architecture scales automatically.</p>
            </div>
        </div>

    </div>

    <!-- AI Assistant -->
    <div id="ai-assistant-btn"
        style="position: fixed; bottom: 20px; right: 20px; background: #000; color: #fff; padding: 15px; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-weight: bold; display: flex; align-items: center; gap: 10px; z-index: 1000; transition: transform 0.2s;">
        <span>ü§ñ</span> Ask AI
    </div>
    <div id="ai-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div
            style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; position: relative;">
            <h2 style="margin-top: 0; color: #333;">ü§ñ AI Prompt Helper</h2>
            <p style="color: #666;">Copy to ChatGPT/Gemini:</p>
            <textarea id="ai-prompt-text"
                style="width: 100%; height: 150px; padding: 10px; border: 2px solid #ddd; border-radius: 8px; margin: 15px 0; font-family: monospace;"></textarea>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="document.getElementById('ai-modal').style.display='none'"
                    style="padding: 10px 20px; border: none; background: #eee; cursor: pointer; border-radius: 5px;">Close</button>
                <button
                    onclick="navigator.clipboard.writeText(document.getElementById('ai-prompt-text').value); alert('Copied!')"
                    style="padding: 10px 20px; border: none; background: #FF6B4A; color: white; cursor: pointer; border-radius: 5px;">Copy
                    Prompt</button>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('ai-assistant-btn').onclick = () => document.getElementById('ai-modal').style.display = 'flex';
        document.getElementById('ai-prompt-text').value = `I am reading the "${document.title}" module.\n\nI am confused about this topic.\n\nCan you explain it simply?`; 
    </script>
</body>

</html>