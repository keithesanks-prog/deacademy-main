<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pandas Apply vs Vectorization ‚ö°</title>
    <!-- Learning Tracker -->
    <script src="../learning_tracker.js"></script>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
    <style>
        /* Core CSS for visual consistency */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 38px;
            margin-bottom: 5px;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 18px;
            margin-bottom: 40px;
        }

        /* Tabs */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            background: #f1f2f6;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.2s;
        }

        .tab.active {
            background: #667eea;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .content-section.active {
            display: block;
        }

        /* Cards and Blocks */
        .concept-card {
            background: #fff;
            border: 2px solid #eee;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .concept-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .code-block {
            background: #2d3436;
            color: #dfe6e9;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            margin: 15px 0;
            white-space: pre-wrap;
            font-size: 14px;
        }

        .output-box {
            background: #f1f2f6;
            border-left: 4px solid #20bf6b;
            padding: 15px;
            font-family: monospace;
            margin-top: 5px;
            font-size: 14px;
            white-space: pre-wrap;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .danger-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .comparison-table td {
            padding: 12px;
            border: 1px solid #ddd;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        /* Analogy Box */
        .analogy-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            font-size: 16px;
            line-height: 1.6;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        code {
            background: #f1f2f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            color: #e74c3c;
        }
    </style>
</head>

<body data-module-name="00_python_visual_guides_pandas_apply_vs_vectorized">

    <!-- Nav -->
    <a href="../TRAINING_HUB.html"
        style="display: inline-block; margin: 20px; text-decoration: none; color: #333; font-weight: bold;">‚¨ÖÔ∏è Back to
        Hub</a>

    <div class="container">
        <h1>Pandas Apply vs Vectorization ‚ö°</h1>
        <p class="subtitle">Understanding When to Loop and When to Shout</p>

        <div class="nav-tabs">
            <button class="tab active" onclick="showTab('concept')">1. The Concept</button>
            <button class="tab" onclick="showTab('performance')">2. Performance</button>
            <button class="tab" onclick="showTab('nan-trap')">3. The NaN Trap</button>
            <button class="tab" onclick="showTab('when-apply')">4. When to Use Apply</button>
        </div>

        <!-- TAB 1: THE CONCEPT -->
        <div id="concept" class="content-section active">
            <div class="analogy-box">
                <h2 style="margin-bottom: 15px;">üèüÔ∏è The Stadium Analogy</h2>
                <p><strong>Scenario:</strong> You need to ask 10,000 people in a stadium to write their full name on a
                    card.</p>
                <p style="margin-top: 15px;"><strong>Method 1 (Apply - The Walker):</strong> You walk up to person #1,
                    ask for their first name, write it down, ask for their last name, glue them together, then walk to
                    person #2. Repeat 10,000 times. ‚è±Ô∏è <strong>Takes 3 hours.</strong></p>
                <p style="margin-top: 15px;"><strong>Method 2 (Vectorization - The Announcer):</strong> You shout into
                    the microphone: "Everyone! Take your first name sticker and stick it to your last name sticker!"
                    Everyone does it at once. ‚ö° <strong>Takes 10 seconds.</strong></p>
            </div>

            <div class="concept-card">
                <div class="concept-title">What is Vectorization?</div>
                <p>Vectorization means performing operations on <strong>entire columns at once</strong> using optimized
                    C-level code, rather than looping through rows one-by-one in Python.</p>
                <p style="margin-top: 10px;">Pandas is built on NumPy, which is written in C. When you use vectorized
                    operations, you're letting C do the heavy lifting instead of slow Python loops.</p>
            </div>

            <div class="concept-card">
                <div class="concept-title">The Two Approaches</div>
                <div class="code-block"># ‚ùå SLOW: Using apply (Row-by-row Python loop)
                    df['full_name'] = df.apply(lambda row: f"{row['first']} {row['last']}", axis=1)

                    # ‚úÖ FAST: Using vectorization (Column-level C operation)
                    df['full_name'] = df['first'] + ' ' + df['last']</div>
                <p style="margin-top: 10px;">Both produce the same result, but the second is <strong>100-300x
                        faster</strong> on large datasets.</p>
            </div>
        </div>

        <!-- TAB 2: PERFORMANCE -->
        <div id="performance" class="content-section">
            <div class="concept-card">
                <div class="concept-title">Speed Comparison</div>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Dataset Size</th>
                            <th>Apply (Loop)</th>
                            <th>Vectorized (+)</th>
                            <th>Speedup</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>100 rows</td>
                            <td>0.005 sec</td>
                            <td>0.0001 sec</td>
                            <td>50x faster</td>
                        </tr>
                        <tr>
                            <td>10,000 rows</td>
                            <td>0.5 sec</td>
                            <td>0.002 sec</td>
                            <td>250x faster</td>
                        </tr>
                        <tr>
                            <td>100,000 rows</td>
                            <td>5.0 sec</td>
                            <td>0.02 sec</td>
                            <td>250x faster</td>
                        </tr>
                        <tr>
                            <td>1,000,000 rows</td>
                            <td>50 sec</td>
                            <td>0.2 sec</td>
                            <td>250x faster</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="concept-card">
                <div class="concept-title">Why is Vectorization So Fast?</div>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>No Python Overhead:</strong> Operations run in compiled C code, not interpreted Python.
                    </li>
                    <li><strong>SIMD Instructions:</strong> Modern CPUs can process multiple values in a single
                        instruction.</li>
                    <li><strong>Memory Locality:</strong> Data is stored contiguously in memory, allowing faster access.
                    </li>
                    <li><strong>No Function Call Overhead:</strong> No need to call a Python function for each row.</li>
                </ul>
            </div>

            <div class="concept-card">
                <div class="concept-title">Real Example: Timing the Difference</div>
                <div class="code-block">import pandas as pd
                    import time

                    # Create test data
                    df = pd.DataFrame({
                    'first': ['John'] * 100000,
                    'last': ['Smith'] * 100000
                    })

                    # Method 1: Apply (Slow)
                    start = time.time()
                    df['full_1'] = df.apply(lambda row: f"{row['first']} {row['last']}", axis=1)
                    print(f"Apply: {time.time() - start:.4f} seconds")

                    # Method 2: Vectorized (Fast)
                    start = time.time()
                    df['full_2'] = df['first'] + ' ' + df['last']
                    print(f"Vectorized: {time.time() - start:.4f} seconds")</div>
                <div class="output-box">Apply: 3.2145 seconds
                    Vectorized: 0.0123 seconds
                    Speedup: 261x faster! ‚ö°</div>
            </div>
        </div>

        <!-- TAB 3: THE NaN TRAP -->
        <div id="nan-trap" class="content-section">
            <div class="danger-box">
                <h3 style="margin-bottom: 10px;">‚ö†Ô∏è CRITICAL: The NaN Trap</h3>
                <p>This is the most dangerous difference because it <strong>silently corrupts your data</strong>.</p>
            </div>

            <div class="concept-card">
                <div class="concept-title">The Problem</div>
                <p>When you have missing values (<code>NaN</code>), <code>apply</code> and vectorized operations handle
                    them differently:</p>

                <div class="code-block">import pandas as pd
                    import numpy as np

                    df = pd.DataFrame({
                    'first': ['John', 'Jane', np.nan],
                    'last': ['Smith', np.nan, 'Doe']
                    })</div>

                <h4 style="margin-top: 20px; margin-bottom: 10px;">‚ùå Using Apply (Creates Garbage)</h4>
                <div class="code-block">df['full_apply'] = df.apply(lambda row: f"{row['first']} {row['last']}", axis=1)
                    print(df)</div>
                <div class="output-box"> first last full_apply
                    0 John Smith John Smith
                    1 Jane NaN Jane nan ‚Üê GARBAGE! üö®
                    2 NaN Doe nan Doe ‚Üê GARBAGE! üö®</div>

                <h4 style="margin-top: 20px; margin-bottom: 10px;">‚úÖ Using Vectorization (Handles Correctly)</h4>
                <div class="code-block">df['full_vector'] = df['first'] + ' ' + df['last']
                    print(df)</div>
                <div class="output-box"> first last full_vector
                    0 John Smith John Smith
                    1 Jane NaN NaN ‚Üê Correct! ‚úÖ
                    2 NaN Doe NaN ‚Üê Correct! ‚úÖ</div>
            </div>

            <div class="concept-card">
                <div class="concept-title">Why This Happens</div>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Apply:</strong> Converts <code>NaN</code> to the string <code>"nan"</code> when using
                        f-strings or string formatting.</li>
                    <li><strong>Vectorized:</strong> Preserves <code>NaN</code> as a missing value indicator, which is
                        the correct behavior for data analysis.</li>
                </ul>
            </div>

            <div class="success-box">
                <h4>Best Practice</h4>
                <p>Always use vectorized operations for string concatenation. If you see "nan" appearing in your text
                    columns, you likely used <code>apply</code> incorrectly.</p>
            </div>
        </div>

        <!-- TAB 4: WHEN TO USE APPLY -->
        <div id="when-apply" class="content-section">
            <div class="concept-card">
                <div class="concept-title">When Apply is Actually the Right Choice</div>
                <p>Use <code>apply()</code> only when <strong>vectorization is impossible</strong>. It's your "escape
                    hatch" for complex logic.</p>
            </div>

            <div class="concept-card">
                <div class="concept-title">1. Complex Conditional Logic</div>
                <p>When you need to check multiple columns with messy business rules:</p>
                <div class="code-block">def categorize_customer(row):
                    if row['total_spend'] > 500 and row['membership'] == 'Gold':
                    return 'VIP'
                    elif row['total_spend'] < 10 and row['days_inactive']> 365:
                        return 'Lost'
                        elif row['age'] < 25 and row['student']: return 'Student Discount' else: return 'Standard'
                            df['category']=df.apply(categorize_customer, axis=1)</div>
                            <p style="margin-top: 10px;">This is hard to vectorize cleanly, so <code>apply</code> is
                                acceptable here.</p>
                </div>

                <div class="concept-card">
                    <div class="concept-title">2. External Libraries or APIs</div>
                    <p>When you need to call functions from other libraries that don't support vectorization:</p>
                    <div class="code-block">import geopy

                        # Geocoding API - can't vectorize external API calls
                        df['coordinates'] = df['address'].apply(
                        lambda addr: geopy.geocoders.Nominatim(user_agent="app").geocode(addr)
                        )</div>
                </div>

                <div class="concept-card">
                    <div class="concept-title">3. Processing Lists or Dictionaries</div>
                    <p>When columns contain complex objects:</p>
                    <div class="code-block"># Column contains lists: ['python', 'AI', 'data']
                        df['tag_count'] = df['tags'].apply(len)

                        # Column contains dictionaries
                        df['city'] = df['location'].apply(lambda x: x.get('city', 'Unknown'))</div>
                </div>

                <div class="warning-box">
                    <h4>‚ö° Try Vectorized Alternatives First!</h4>
                    <p>Before using <code>apply</code>, check if there's a built-in accessor:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>String operations:</strong> Use <code>.str</code> accessor instead of
                            <code>apply</code>
                        </li>
                        <li><strong>DateTime operations:</strong> Use <code>.dt</code> accessor instead of
                            <code>apply</code>
                        </li>
                    </ul>
                    <div class="code-block" style="margin-top: 10px;"># ‚ùå DON'T: df['email'].apply(lambda x: x.lower())
                        # ‚úÖ DO: df['email'].str.lower()

                        # ‚ùå DON'T: df['date'].apply(lambda x: x.year)
                        # ‚úÖ DO: df['date'].dt.year</div>
                </div>

                <div class="concept-card">
                    <div class="concept-title">Decision Tree: Should I Use Apply?</div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; font-family: monospace;">
                        <pre>Can I use basic math operators (+, -, *, /)?
‚îú‚îÄ YES ‚Üí Use vectorization ‚úÖ
‚îî‚îÄ NO
   ‚îú‚îÄ Can I use .str or .dt accessor?
   ‚îÇ  ‚îú‚îÄ YES ‚Üí Use accessor ‚úÖ
   ‚îÇ  ‚îî‚îÄ NO
   ‚îÇ     ‚îú‚îÄ Is it complex conditional logic?
   ‚îÇ     ‚îÇ  ‚îú‚îÄ YES ‚Üí Use apply (acceptable) ‚ö†Ô∏è
   ‚îÇ     ‚îÇ  ‚îî‚îÄ NO
   ‚îÇ     ‚îÇ     ‚îú‚îÄ Am I calling external APIs/libraries?
   ‚îÇ     ‚îÇ     ‚îÇ  ‚îú‚îÄ YES ‚Üí Use apply (acceptable) ‚ö†Ô∏è
   ‚îÇ     ‚îÇ     ‚îÇ  ‚îî‚îÄ NO ‚Üí Rethink your approach ü§î</pre>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function showTab(tabId) {
                document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                const btn = Array.from(document.querySelectorAll('.tab')).find(b => b.getAttribute('onclick').includes(tabId));
                if (btn) btn.classList.add('active');
            }
        </script>
        <!-- AI Assistant -->
        <div id="ai-assistant-btn"
            style="position: fixed; bottom: 20px; right: 20px; background: #000; color: #fff; padding: 15px; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-weight: bold; display: flex; align-items: center; gap: 10px; z-index: 1000; transition: transform 0.2s;">
            <span>ü§ñ</span> Ask AI
        </div>
        <div id="ai-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
            <div
                style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; position: relative;">
                <h2 style="margin-top: 0; color: #333;">ü§ñ AI Prompt Helper</h2>
                <p style="color: #666;">Copy to ChatGPT/Gemini:</p>
                <textarea id="ai-prompt-text"
                    style="width: 100%; height: 150px; padding: 10px; border: 2px solid #ddd; border-radius: 8px; margin: 15px 0; font-family: monospace;"></textarea>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="document.getElementById('ai-modal').style.display='none'"
                        style="padding: 10px 20px; border: none; background: #eee; cursor: pointer; border-radius: 5px;">Close</button>
                    <button
                        onclick="navigator.clipboard.writeText(document.getElementById('ai-prompt-text').value); alert('Copied!')"
                        style="padding: 10px 20px; border: none; background: #FF6B4A; color: white; cursor: pointer; border-radius: 5px;">Copy
                        Prompt</button>
                </div>
            </div>
        </div>
        <script>
            document.getElementById('ai-assistant-btn').onclick = () => document.getElementById('ai-modal').style.display = 'flex';
            document.getElementById('ai-prompt-text').value = `I am reading the "${document.title}" module.\n\nI am confused about this topic.\n\nCan you explain it simply?`; 
        </script>
</body>

</html>